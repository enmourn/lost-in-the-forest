var S=Object.defineProperty;var x=(l,t,o)=>t in l?S(l,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[t]=o;var r=(l,t,o)=>(x(l,typeof t!="symbol"?t+"":t,o),o);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const e of s)if(e.type==="childList")for(const a of e.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function o(s){const e={};return s.integrity&&(e.integrity=s.integrity),s.referrerpolicy&&(e.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?e.credentials="include":s.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function i(s){if(s.ep)return;s.ep=!0;const e=o(s);fetch(s.href,e)}})();class b{constructor(t){r(this,"element");r(this,"ctx");r(this,"scale");r(this,"viewport");r(this,"resize",()=>{this.element.width=innerWidth,this.element.height=innerHeight,this.scale=Math.max(innerWidth/this.viewport.w,innerHeight/this.viewport.h)});const o=document.querySelector("canvas");if(!o)throw new Error("no canvas element");this.element=o;const i=this.element.getContext("2d");if(!i)throw new Error("no canvas context");this.ctx=i,this.scale=1,this.viewport=t,this.resize(),window.onresize=this.resize}}class z{constructor(t,o,i){r(this,"w");r(this,"h");r(this,"color");this.w=t,this.h=o,this.color=i}render({ctx:t}){t.fillStyle=this.color,t.fillRect(0,0,this.w,this.h)}}class L{constructor(t,o,i,s){r(this,"x");r(this,"y");r(this,"size");r(this,"color");this.x=t,this.y=o,this.size=i,this.color=s}render({ctx:t}){t.beginPath(),t.arc(this.x,this.y,this.size,0,2*Math.PI),t.fillStyle=this.color,t.fill()}}function R(l,t){return Math.sqrt(Math.pow(l.x-t.x,2)+Math.pow(l.y-t.y,2))<=l.r+t.r}function m(l){return l*Math.PI/180}function v(l,t){return(t-l)*Math.random()+l}class A{constructor(t){r(this,"w");r(this,"h");r(this,"areaSize");r(this,"ground");r(this,"areas");r(this,"getAreaByCoord",({x:t,y:o})=>{var e,a;const i=Math.floor(t/this.areaSize),s=Math.floor(o/this.areaSize);return(a=(e=this.areas)==null?void 0:e[i])==null?void 0:a[s]});r(this,"getCurrentAreas",({x:t,y:o})=>{var h,c,n,p,u,y,w,f;const i=Math.floor(t/this.areaSize),s=Math.floor(o/this.areaSize),e=t/this.areaSize-i>.5?1:-1,a=o/this.areaSize-s>.5?1:-1;return[...((c=(h=this.areas)==null?void 0:h[i])==null?void 0:c[s])??[],...((p=(n=this.areas)==null?void 0:n[i+e])==null?void 0:p[s])??[],...((y=(u=this.areas)==null?void 0:u[i])==null?void 0:y[s+a])??[],...((f=(w=this.areas)==null?void 0:w[i+e])==null?void 0:f[s+a])??[]]});this.w=t.w,this.h=t.h,this.areaSize=t.areaSize,this.ground=new z(this.w,this.h,t.ground.color);const o=Math.ceil(this.w/this.areaSize),i=Math.ceil(this.h/this.areaSize);this.areas=Array.from(Array(o),()=>Array.from(Array(i),()=>[]));const s=t.trees.density*this.w*this.h;for(let e=0;e<s;e++){const a=v(t.trees.size.min,t.trees.size.max),h={x:v(0,this.w),y:v(0,this.h)};if(h.x>this.w/2-150&&h.x<this.w/2+150&&h.y>this.h/2-150&&h.y<this.h/2+150){e--;continue}const c=new L(h.x,h.y,a,t.trees.color),n=this.getAreaByCoord(c);n&&n.push(c)}}}class M{constructor(t){r(this,"state");r(this,"timeReset");r(this,"timeStart");r(this,"timeStep");r(this,"update");r(this,"render");r(this,"loop",t=>{for(this.timeReset&&(this.timeStart=t);this.state==="start"&&this.timeStart<=t;)this.update(),this.timeStart+=this.timeStep;this.state!=="stop"&&this.render(),requestAnimationFrame(this.loop)});r(this,"start",()=>{this.state="start",this.timeReset=!0});r(this,"pause",()=>{this.state="pause"});r(this,"stop",()=>{this.state="stop"});this.state="stop",this.timeReset=!0,this.timeStart=0,this.timeStep=1e3/t.fps,this.update=t.update,this.render=t.render,requestAnimationFrame(this.loop)}}class k{constructor(){r(this,"left");r(this,"right");r(this,"up");r(this,"down");r(this,"g");this.left=!1,this.right=!1,this.up=!1,this.down=!1,this.g=!1,document.onkeydown=t=>{(t.code==="KeyA"||t.code==="ArrowLeft")&&(this.left=!0),(t.code==="KeyD"||t.code==="ArrowRight")&&(this.right=!0),(t.code==="KeyW"||t.code==="ArrowUp")&&(this.up=!0),(t.code==="KeyS"||t.code==="ArrowDown")&&(this.down=!0),t.code==="KeyG"&&(this.g=!0)},document.onkeyup=t=>{(t.code==="KeyA"||t.code==="ArrowLeft")&&(this.left=!1),(t.code==="KeyD"||t.code==="ArrowRight")&&(this.right=!1),(t.code==="KeyW"||t.code==="ArrowUp")&&(this.up=!1),(t.code==="KeyS"||t.code==="ArrowDown")&&(this.down=!1),t.code==="KeyG"&&(this.g=!1)}}pressOnce(t,o){const i=s=>{s.key===t&&(o(),document.removeEventListener("keypress",i))};document.addEventListener("keypress",i)}}class E{constructor(t){r(this,"x");r(this,"y");r(this,"size");r(this,"speeds");r(this,"speed");r(this,"spin");r(this,"lives");r(this,"live");r(this,"angle");r(this,"confuse");r(this,"color");this.x=t.x,this.y=t.y,this.size=t.size,this.speeds=t.speeds,this.speed=this.speeds[0],this.spin=t.spin,this.lives=t.lives,this.live=this.lives[0],this.angle=0,this.confuse={x:Math.random()>.5?1:-1,y:Math.random()>.5?1:-1},this.color=t.color}render({ctx:t}){t.beginPath(),t.arc(this.x,this.y,this.size,0,2*Math.PI),t.fillStyle=this.color,t.fill()}}class H{constructor(t){r(this,"percent");r(this,"color");this.percent=1,this.color=t.color}render({ctx:t,element:o}){t.strokeStyle=this.color.border,t.strokeRect(o.width-300-20,o.height-40,300,20),t.fillStyle=this.color.body,t.fillRect(o.width-300-19,o.height-39,300*this.percent-2,18)}}class T{constructor(t){r(this,"map");r(this,"margin");r(this,"color");r(this,"way");r(this,"oldWays");r(this,"counter");r(this,"setCoord",(t,o)=>{this.counter===0&&(this.way.push({x:t,y:o}),this.counter=120*5),this.counter--});r(this,"render",({ctx:t,element:o})=>{if(!this.way.length)return;const i=Math.min((o.width-this.margin*2)/this.map.w,(o.height-this.margin*2)/this.map.h),s={x:(o.width-this.map.w*i)/2,y:(o.height-this.map.h*i)/2};t.fillStyle=this.color.overlay,t.fillRect(0,0,o.width,o.height),t.fillStyle=this.color.bg,t.fillRect(s.x,s.y,this.map.w*i,this.map.h*i);const e=(h,c)=>{t.strokeStyle=c,t.beginPath(),t.moveTo(h[0].x*i+s.x,h[0].y*i+s.y),h.forEach(n=>t.lineTo(n.x*i+s.x,n.y*i+s.y)),t.stroke()};e(this.way,this.color.way),this.oldWays.forEach(h=>e(h,this.color.oldWay));const a=this.way[this.way.length-1];t.beginPath(),t.moveTo(a.x*i+s.x,a.y*i+s.y),t.lineTo(a.x*i+s.x-6,a.y*i+s.y-8),t.lineTo(a.x*i+s.x+6,a.y*i+s.y-8),t.fillStyle=this.color.way,t.fill()});this.map=t.map,this.margin=t.margin,this.color=t.color,this.way=[],this.oldWays=[],this.counter=0}restart(){this.oldWays.push(this.way),this.counter=0,this.way=[]}}class W{constructor(t){r(this,"status");r(this,"color");r(this,"font");this.status=null,this.color=t.color,this.font=t.font}render({ctx:t,element:o}){t.fillStyle=this.color.overlay,t.fillRect(0,0,o.width,o.height),t.fillStyle=this.color.body;let i=[];const s=600,e={x:(o.width-s)/2,y:0};this.status==="about"?(e.y=(o.height-310)/2,t.fillRect(e.x,e.y,s,310),i=["Каждый год только в российских лесах теряется свыше","5 000 человек. 80% потерявшихся выживают, 13% находят","погибшими, еще 7% считаются пропавшими без вести..."," ","Lost In The Forest - симулятор, созданный, чтобы","наглядно показать, что происходит с человеком,","заблудившимся в лесу. Надеемся в реальной жизни с","вами этого никогда не произойдет!","","Нажмите ENTER чтобы продолжить"]):this.status==="intro"?(e.y=(o.height-360)/2,t.fillRect(e.x,e.y,s,360),i=["Все началось с того, что вы отправились за грибами,","две недели стоятла прекрасная теплая погода и","стоило вам только зайти в лес, как корина для грибов","начала стремительно наполняться...","","Спустя час или полтора, вы решили, что грибов уже","достаточно и пора возвращаться, но пройдя минут 20","в обратном направлении, не оказались там, где ","рассчитывали. Возникло непонимание куда идти.","Похоже вы заблудились...","","Нажмите ENTER чтобы продолжить"]):this.status==="start"?(e.y=(o.height-210)/2,t.fillRect(e.x,e.y,s,210),i=["Используйте стрелки клавиатуры или клавиши A W S D","для движения, клавишу G для отображения вашего","местоположения. Следите за количеством ваших сил","по шкале в правом нижнем углу экрана.","","Нажмите ENTER чтобы начать"]):this.status==="win"?(e.y=(o.height-210)/2,t.fillRect(e.x,e.y,s,210),i=["Обычная прогулка по лесу обернулась для вас","настоящим приключением, но ваши навыки","ориентирования вас не подвели!","Поздавляю! Вы спаслись!","","Нажмите Enter чтобы попробовать еще раз"]):this.status==="attempt1"?(e.y=(o.height-310)/2,t.fillRect(e.x,e.y,s,310),i=["Вы потратили немало сил и вам захотелось ненадолго","остановиться и отдохнуть. Небо, еще недавно озаренное","солнцем, плотно затянуло тяжелыми дождевыми тучами.","Вы почувствовали, как холодный ветер предательски","пробивается сквозь одежду, вызывая прохладу и легкую","дрожь в теле. Теплый шерстяной свитер, оставленный","дома, вам бы сейчас очень пригодился... Чтобы не","замерзнуть - нужно двигаться!","","Нажмите Enter чтобы продолжить"]):this.status==="attempt2"?(e.y=(o.height-290)/2,t.fillRect(e.x,e.y,s,290),i=["Вы крайне сильно замерзли и очень сильно устали...","Начавшийся дождь сперва не вызывал никаких","опасений, но спустя некоторое время штаны, куртка","и сапоги промокли насквозь. Ноги начали замерзать","даже во время движения. Вам захотелось согреться","возле костера, но спичек или зажигалки у вас с собой,","не оказалось...","","Нажмите Enter чтобы продолжить"]):this.status==="loss"&&(e.y=(o.height-250)/2,t.fillRect(e.x,e.y,s,250),i=["Дождь закончился. На прояснившемся небе засияли","звезды. Уже стемнело и они казались ослепляюще","яркими, будто согревающими вас своим светом...","Сил больше не было, только желание закрыть глаза","и оказаться дома... К сожалению вы не выжили...","","Нажмите Enter чтобы попробовать еще раз"]),t.fillStyle=this.font.color,t.font="20px arial",i.forEach((a,h)=>t.fillText(a,e.x+30,e.y+50+h*25))}}class C{constructor(t){r(this,"canvas");r(this,"map");r(this,"loop");r(this,"keyboard");r(this,"player");r(this,"liveScale");r(this,"gps");r(this,"alert");r(this,"level");r(this,"start",()=>{const{loop:t,keyboard:o,alert:i}=this;t.pause(),i.status="about",o.pressOnce("Enter",()=>{i.status="intro",o.pressOnce("Enter",()=>{i.status="start",o.pressOnce("Enter",()=>{i.status=null,t.start()})})})});r(this,"restart",()=>{const t=this,{map:o,player:i,gps:s,alert:e}=this;e.status=null,i.live=i.lives[0],i.speed=i.speeds[0],i.x=o.w/2,i.y=o.h/2,t.level=1,s.restart()});r(this,"update",()=>{const t=this,{map:o,loop:i,keyboard:s,player:e,liveScale:a,gps:h,alert:c}=this;(e.x<0||e.x>o.w||e.y<0||e.y>o.h)&&(i.pause(),c.status="win",s.pressOnce("Enter",()=>{t.restart(),i.start()})),e.live<=0&&(i.pause(),t.level==1&&(c.status="attempt1"),t.level==2&&(c.status="attempt2"),t.level==3&&(c.status="loss"),s.pressOnce("Enter",()=>{t.level==1||t.level==2?(c.status=null,e.live=e.lives[t.level],e.speed=e.speeds[t.level],t.level++,i.start()):(t.restart(),i.start())})),e.live--,a.percent=e.live/e.lives[0];const n={x:-s.left+ +s.right,y:-s.up+ +s.down},p=e.speed/(n.x!==0&&n.y!==0?Math.SQRT2:1),u={sin:Math.sin(m(e.angle)),cos:Math.cos(m(e.angle))},y={x:e.x+n.y*p*u.sin+n.x*p*u.cos,y:e.y+n.y*p*u.cos-n.x*p*u.sin},w=o.getCurrentAreas(y);let f=!1;for(let g of w)if(f=R({x:y.x,y:y.y,r:e.size},{x:g.x,y:g.y,r:g.size}),f)break;f||(e.x=y.x,e.y=y.y,n.y?e.angle+=e.spin*n.y*e.confuse.x:n.x&&(e.angle+=e.spin*n.x*e.confuse.y)),h.setCoord(e.x,e.y)});r(this,"render",()=>{const{canvas:t,map:o,keyboard:i,player:s,liveScale:e,gps:a,alert:h}=this;t.ctx.clearRect(0,0,t.element.width,t.element.height),t.ctx.scale(t.scale,t.scale),t.ctx.translate(t.element.width/t.scale/2-s.x,t.element.height/t.scale/2-s.y);const c=m(s.angle);t.ctx.translate(s.x,s.y),t.ctx.rotate(c),t.ctx.translate(-s.x,-s.y),o.ground.render(t),o.getCurrentAreas(s).forEach(n=>n.render(t)),t.ctx.translate(s.x,s.y),t.ctx.rotate(-c),t.ctx.translate(-s.x,-s.y),s.render(t),t.ctx.resetTransform(),e.render(t),h.status&&h.render(t),i.g&&!h.status&&a.render(t)});this.canvas=new b(t.viewport);const o=Math.sqrt(Math.pow(t.viewport.w,2)+Math.pow(t.viewport.h,2));this.map=new A({...t.map,areaSize:o}),this.keyboard=new k,this.loop=new M({fps:t.fps,update:this.update,render:this.render}),this.player=new E({...t.player,x:this.map.w/2,y:this.map.h/2}),this.liveScale=new H(t.liveScale),this.gps=new T({map:t.map,...t.gps}),this.alert=new W(t.alert),this.level=1,this.start()}}const d={green:"#00b894",greenLight:"#55efc4",robin:"#00cec9",robinLign:"#81ecec",blue:"#0984e3",blueLight:"#74b9ff",violet:"#6c5ce7",violetLight:"#a29bfe",gray:"#b2bec3",grayLight:"#dfe6e9",yellow:"#fdcb6e",yellowLight:"#ffeaa7",orange:"#e17055",orangeLight:"#fab1a0",red:"#d63031",redLight:"#ff7675",pink:"#e84393",pinkLight:"#fd79a8",black:"#2d3436",blackLight:"#636e72"},K={viewport:{w:1300,h:654},map:{w:4e4,h:4e4,ground:{color:d.grayLight},trees:{density:19e-5,size:{min:10,max:50},color:d.green}},player:{size:10,speeds:[1.5,1.3,1.1],spin:.01,lives:[60*60*15,60*60*8,60*60*4],color:d.blackLight},gps:{margin:20,color:{overlay:"#000000cc",bg:d.blackLight,way:d.red,oldWay:d.black}},liveScale:{color:{border:d.redLight,body:d.red}},alert:{color:{overlay:"#000000cc",body:d.black},font:{color:d.grayLight}},fps:60};new C(K);
